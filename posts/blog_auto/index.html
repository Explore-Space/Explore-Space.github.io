<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Hugo 自动部署"><meta itemprop=description content="0x00 摘要 基于 Hugo 的 Blog 搭建与自动部署配置 0x01 起源 起初，笔者觉得 Hexo 无疑是最好的博客框架，友好的配置与丰富的主题及插件。但极慢的加载速度消耗着笔者的耐心"><meta itemprop=datePublished content="2019-12-17T23:31:18+08:00"><meta itemprop=dateModified content="2019-12-17T23:31:18+08:00"><meta itemprop=wordCount content="2533"><meta itemprop=keywords content="Blog,Github Actions,"><meta property="og:title" content="Hugo 自动部署"><meta property="og:description" content="0x00 摘要 基于 Hugo 的 Blog 搭建与自动部署配置 0x01 起源 起初，笔者觉得 Hexo 无疑是最好的博客框架，友好的配置与丰富的主题及插件。但极慢的加载速度消耗着笔者的耐心"><meta property="og:type" content="article"><meta property="og:url" content="https://explore-space.github.io/posts/blog_auto/"><meta property="article:published_time" content="2019-12-17T23:31:18+08:00"><meta property="article:modified_time" content="2019-12-17T23:31:18+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hugo 自动部署"><meta name=twitter:description content="0x00 摘要 基于 Hugo 的 Blog 搭建与自动部署配置 0x01 起源 起初，笔者觉得 Hexo 无疑是最好的博客框架，友好的配置与丰富的主题及插件。但极慢的加载速度消耗着笔者的耐心"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Hugo 自动部署</title><link rel=stylesheet href=https://explore-space.github.io/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://explore-space.github.io/>An's Blog</a></div><nav class="site-nav hide-in-mobile"><a href=https://explore-space.github.io/posts/>Posts</a>
<a href=https://explore-space.github.io/tags/>Tags</a>
<a href=https://explore-space.github.io/music/>Music</a>
<a href=https://explore-space.github.io/gallery/>Gallery</a>
<a href=https://explore-space.github.io/about/>About</a></nav></div><div class="hdr-right hdr-icons"><button id=toc-btn class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3" y2="6"/><line x1="3" y1="12" x2="3" y2="12"/><line x1="3" y1="18" x2="3" y2="18"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://github.com/Explore-Space/ target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://gitlab.com/Explore-Space target=_blank rel="noopener me" title=Gitlab><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.65 14.39 12 22.13 1.35 14.39a.84.84.0 01-.3-.94l1.22-3.78 2.44-7.51A.42.42.0 014.82 2a.43.43.0 01.58.0.42.42.0 01.11.18l2.44 7.49h8.1l2.44-7.51A.42.42.0 0118.6 2a.43.43.0 01.58.0.42.42.0 01.11.18l2.44 7.51L23 13.45a.84.84.0 01-.35.94z"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://explore-space.github.io/posts/>Posts</a></li><li><a href=https://explore-space.github.io/tags/>Tags</a></li><li><a href=https://explore-space.github.io/music/>Music</a></li><li><a href=https://explore-space.github.io/gallery/>Gallery</a></li><li><a href=https://explore-space.github.io/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>2019-12-17</span></div><h1>Hugo 自动部署</h1></header><div class=content><hr><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css><script src=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script><script src=https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js></script><p><meting-js server=netease type=song id=27759600></meting-js></p><h2 id=0x00-摘要>0x00 摘要<a href=#0x00-摘要 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>基于 Hugo 的 Blog 搭建与自动部署配置</p><h2 id=0x01-起源>0x01 起源<a href=#0x01-起源 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>起初，笔者觉得 <a href=https://hexo.io/>Hexo</a> 无疑是最好的博客框架，友好的配置与丰富的主题及插件。但极慢的加载速度消耗着笔者的耐心，最终下定决心再一次重构 Blog。这次笔者采用对加载速度优化更好的 <a href=https://gohugo.io/>Hugo</a> 框架。笔者之前采用 <a href=https://travis-ci.org>Travis-ci</a> 实现自动部署，目前其网站处于被墙的边缘，而且属于第三方服务，目前 <a href=https://github.com/features/actions>Github Actions</a> 已发布正式版，故笔者决定采用 Actions 实现自动部署。</p><p>最终，新 Blog 的方案确定: <del><a href=https://hexo.io/>Hexo</a></del> <em><strong><a href=https://gohugo.io/>Hugo</a></strong></em> + <del><a href=https://travis-ci.org>Travis-ci</a></del> <em><strong><a href=https://github.com/features/actions>Github Actions</a></strong></em></p><h2 id=0x02-搭建>0x02 搭建<a href=#0x02-搭建 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>笔者本地环境为:</p><ul><li>OS: <em>Manjaro 18.1.4 Juhraya</em></li><li>Kernel: <em>Linux 5.4.2-1-MANJARO</em></li><li>Hugo: <em>v0.60.1/extended linux/amd64</em></li></ul><blockquote><p><strong>预期效果</strong></p><p>1.在特定仓库下有两个分支:</p><blockquote><p>① source: 默认分支，存储整个 Blog 的源代码</p><p>② master: 主分支，存储生成的静态页面，并以此生成 Github Page</p></blockquote><p>2.利用 Github Actions 实现自动部署，即: 向 source 分支推送文章或配置更改，由 Actions 编译生成静态页面，推送至 master 分支，更新 Github Page 实现对 Blog 的更改</p></blockquote><p>P.S. 方案不止这一种，但笔者觉得这样最方便，最符合笔者需求，故下文均以此方案为基础</p><h3 id=创建仓库>创建仓库<a href=#创建仓库 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>在 Github 上创建仓库，仓库名为 <em><strong><code>□□□□□.github.io</code></strong></em> 。创建时为方便下部操作建议勾选 <em>Initialize this repository with a README</em> 。</p><p>P.S. □□□□□ 为你的 Github 用户名</p><h3 id=创建分支>创建分支<a href=#创建分支 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>仓库创建完成后，点击左侧 <em>Branch: master</em> ，输入 <em><strong><code>source</code></strong></em></p><p>P.S. <em><strong><code>source</code></strong></em> 可自行更改，下文 source 分支均指存储 Blog 所有源代码的分支</p><h3 id=更改默认分支>更改默认分支<a href=#更改默认分支 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>仓库创建后默认分支为 master 分支，为方便管理，需更改 source 为默认分支。将仓库的 <em>Settings</em> → <em>Branches</em> → <em>Default branch</em> 修改为 <em><strong><code>source</code></strong></em> 分支</p><h3 id=添加ssh部署密钥>添加SSH部署密钥<a href=#添加ssh部署密钥 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>在本地终端执行以下命令生成部署密钥。执行完成后，会在当前目录下生成 <code>gh-pages.pub</code> 「公钥」 和 <code>gh-pages</code> 「私钥」</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>ssh-keygen -t rsa -b <span class=m>4096</span> -C <span class=s2>&#34;</span><span class=k>$(</span>git config user.email<span class=k>)</span><span class=s2>&#34;</span> -f gh-pages -N <span class=s2>&#34;&#34;</span>
</code></pre></div><p>P.S. 上述命令中 <code>$(git config user.email)</code> 可直接替换为邮箱地址</p><p>进入仓库的 <em>Settings</em> 中:</p><ul><li><p>在 <em>Deploy keys</em> 中添加公钥; <strong>Title</strong> 自定义即可，<strong>Key</strong> 则填入 <code>gh-pages.pub</code> 「公钥」 的内容，并勾选 <code>Allow write access</code></p><ul><li>添加公钥</li></ul><p><img src=/Image/posts/Blog_Auto/deploy-keys-1.jpg alt=添加公钥></p><ul><li>成功</li></ul><p><img src=/Image/posts/Blog_Auto/deploy-keys-2.jpg alt=成功></p></li><li><p>在 <em>Secrets</em> 中添加私钥; <strong>Name</strong> 填入 <code>ACTIONS_DEPLOY_KEY</code>，<strong>Value</strong> 则填入<code>gh-pages</code> 「私钥」</p><ul><li>添加私钥</li></ul><p><img src=/Image/posts/Blog_Auto/secrets-1.jpg alt=添加私钥></p><ul><li>成功</li></ul><p><img src=/Image/posts/Blog_Auto/secrets-2.jpg alt=成功></p></li></ul><blockquote><p><strong>注意！！！</strong></p><p>在添加私钥时需格外注意，<code>gh-pages</code> 「私钥」 的格式大致如下</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>-----BEGIN OPENSSH PRIVATE KEY-----
□□□...□□
□□□...□□
...
□□□...□□
-----END OPENSSH PRIVATE KEY-----
</code></pre></div><p>在 <em>Secrets</em> 中 <strong>Value</strong> 需填入<code>gh-pages</code> 所有内容。即包括 <code>-----BEGIN OPENSSH PRIVATE KEY-----</code> 和 <code>-----END OPENSSH PRIVATE KEY-----</code> 以及之间的密钥</p><p>笔者在部署时，并没有意识到这一点，在这里卡了很久。笔者只在 <strong>Value</strong> 中填入其中的密钥部分。在之后的 Github Actions 部署过程中总是报错，大致意思是 没有仓库的写入权限 。</p></blockquote><h3 id=创建-hugo-站点>创建 Hugo 站点<a href=#创建-hugo-站点 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>执行以下命令，会在当前目录下生成 Hugo 站点的标准文件</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>hugo new site Blog
</code></pre></div><p>P.S. 上述命令中 <code>Blog</code> 可自行定义</p><p>使用 <code>git clone</code> 命令将远端的 <em><strong><code>□□□□□.github.io</code></strong></em> 仓库 clone 到本地，然后将生成的 Blog 文件夹下所有内容复制至本地 <em><strong><code>□□□□□.github.io</code></strong></em> 仓库，并进入该仓库文件夹</p><h3 id=添加主题>添加主题<a href=#添加主题 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><blockquote><p>主题来源:<a href=https://themes.gohugo.io/>Hugo Themes</a></p><p>以下以笔者使用的主题 <a href=https://github.com/Track3/hermit>hermit</a> 为例</p></blockquote><p>P.S. 多数 Hugo 主题仓库下都会有相应说明文件</p><p>在 Hugo 站点的根目录(即本地 <em><strong><code>□□□□□.github.io</code></strong></em> 仓库)下执行以下命令添加主题</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>git clone https://github.com/Track3/hermit.git themes/hermit
</code></pre></div><p>操作可选:</p><ul><li>执行以下命令将此主题存储库作为 git 子模块包含在内。适用于不需要对主题进行深度定制，或希望轻松的获取主题更新 <strong>「推荐」</strong> 后续操作均以此为基础</li></ul><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>git submodule add https://github.com/Track3/hermit.git themes/hermit
</code></pre></div><ul><li>删除主题存储库下的 <code>.git</code> 文件夹，将主题文件直接作为 <em><strong><code>□□□□□.github.io</code></strong></em> 仓库的组成</li></ul><h3 id=添加配置-github-actions-配置文件>添加配置 Github Actions 配置文件<a href=#添加配置-github-actions-配置文件 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>参考: <a href=https://github.com/peaceiris/actions-gh-pages/blob/master/README.md>actions-gh-pages</a></p><blockquote><p>简单说明一下 Github Actions 的工作原理(以 Blog 自动部署为例)，不一定准确但简单易懂：</p><p>常规情况下，部署 Hugo 站点需要手动在本地编译出静态文件，然后将其推送至远端，生成静态网页。而 Actions 相当于远端有一台 Linux 虚拟机，当检测到你的仓库 source 分支有变化时，会将你的仓库克隆下来，编译后将生成的静态文件推送至远端仓库 master 分支。</p><p>因为远端的虚拟机需要拉取及推送仓库，所以需要有仓库的读写权限，这样就很容易理解上文 <em><a href=/posts/blog_auto/#ssh>添加SSH部署密钥</a></em> 中的操作</p></blockquote><p>在 Hugo 站点的根目录(即本地 <em><strong><code>□□□□□.github.io</code></strong></em> 仓库)下，新建 <code>.github/workflows/gh-pages.yml</code> 文件</p><p>以下为笔者的配置文件</p><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>github pages</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>source</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>build-deploy</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-18.04</span><span class=w>
</span><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v1</span><span class=w>
</span><span class=w>      </span><span class=c># with:</span><span class=w>
</span><span class=w>      </span><span class=c>#   submodules: true</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Hugo</span><span class=w>
</span><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-hugo@v2</span><span class=w>
</span><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>hugo-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0.59.1&#39;</span><span class=w>
</span><span class=w>        </span><span class=c># extended: true</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span><span class=sd>        git clone https://github.com/Track3/hermit.git themes/hermit
</span><span class=sd>        hugo --minify</span><span class=w>        
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-gh-pages@v2</span><span class=w>
</span><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>ACTIONS_DEPLOY_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.ACTIONS_DEPLOY_KEY }}</span><span class=w>
</span><span class=w>        </span><span class=nt>PUBLISH_BRANCH</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w>
</span><span class=w>        </span><span class=nt>PUBLISH_DIR</span><span class=p>:</span><span class=w> </span><span class=l>./public</span><span class=w>
</span></code></pre></div><ul><li><p>P.S.</p><ul><li><p>分支相关</p><p>配置文件头部以下部分中，<code>source</code> 为站点源代码存储分支，需根据实际情况修改</p><div class=highlight><pre class=chroma><code class=language-YAML data-lang=YAML><span class=nt>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>source</span><span class=w>
</span></code></pre></div></li><li><p>hugo-version 相关</p><p>Hugo 目前最新版为 <strong>0.60.1</strong>，但笔者目前[2019-12-17 23:31:18]在测试中遇到了Bug: Markdown 文件中 HTML 部分无法渲染，故笔者采用 <strong>0.59.1</strong> 部署 Blog</p></li><li><p>Hugo 主题相关</p><p>上文 <em><a href=/posts/blog_auto/#heading3>添加主题</a></em> 中，笔者将主题仓库作为笔者仓库的子模块。这样当执行 <code>git clone</code> 时，不会将子模块一同 clone 下来，即站点 <code>/themes</code> 是空的</p><p>↓ <code>/themes</code> 为空时，站点 HTML 文件渲染错误，报错信息如下</p><p><img src=/Image/posts/Blog_Auto/Error_001.png alt=报错></p><p>解决：在执行 <code>hugo --minify</code> 之前添加以下内容，手动将主题文件 clone 下来</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>git clone https://github.com/Track3/hermit.git themes/hermit
</code></pre></div></li></ul></li></ul><h3 id=推送>推送<a href=#推送 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>完成上述步骤后，将本地仓库推送至远端，等待 Action 完成自动部署，完成后稍等即可访问 <code>□□□□□.github.io</code> 查看站点内容。</p><p>P.S. □□□□□ 为你的 Github 用户名</p><ul><li><p>关于时间</p><ul><li><p>推送完成到 Github Actions 开始动作: 约 1 s</p></li><li><p>Github Actions 开始动作到部署完成: 约 40 s</p></li><li><p>初次部署完成到站点正常访问: 约 3 min</p></li><li><p>更新部署完成到站点更新: 约 5 s</p></li></ul></li></ul><h2 id=0x03-问题>0x03 问题<a href=#0x03-问题 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><blockquote><p>笔者觉得相比于结果解决问题的过程和思路更重要，故记录笔者遇到问题及解决的思路</p></blockquote><h3 id=密钥添加>密钥添加<a href=#密钥添加 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>笔者在上文 <em><a href=/posts/blog_auto/#ssh>添加SSH部署密钥</a></em> 的 <em>注意</em> 中，也提到了因为私钥添加错误导致卡了很久。笔者看到 Actions 报错，本能的以为是其配置文件有问题(Actions 正式发布没多久，所以相应的文档较少)，所以反复尝试: 修改 Github Actions 配置文件，推送至远端，等待&mldr;一如既往的报错。笔者也很沮丧，甚至想放弃 <em><strong><a href=https://gohugo.io/>Hugo</a> + <a href=https://github.com/features/actions>Github Actions</a></strong></em> 重新采用 <em><strong><a href=https://hexo.io/>Hexo</a> + <a href=https://travis-ci.org>Travis-ci</a></strong></em> 。</p><p>等笔者静下心，查看 Actions 的报错信息时，发现前面环境部署以及静态文件的编译都完成了，就最后推送至远端仓库时，写入权限报错。笔者开始逆向查找问题，首先检查的便是 <em>公钥</em> 与 <em>私钥</em> ，很快就发现了问题所在，修复后问题解决。</p><h3 id=git-子模块>Git 子模块<a href=#git-子模块 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>在 Actions 完成部署后，笔者访问站点一看傻眼了</p><p><img src=/Image/posts/Blog_Auto/Error_001.png alt=报错></p><p>笔者首先利用 <code>hugo server</code> 检查了本地仓库是否正常，本地可以正常生成站点;然后又检查了远端仓库 master 分支，Actions 正确的将静态文件文件推送进来，笔者想不通哪里出了问题。</p><p>笔者根据网页显示的报错信息四处检索，忽然看到有人说是不是站点下没有 HTML 文件。笔者重新检查了 master 分支，的确在根目录下只有 <code>index.xml</code> ，而没有 <code>index.html</code> 。但笔者还是想不明白问什么会这样，继续检索。最后，笔者在 Hugo Github 仓库的 Issues 下看到，有人因为生成 Hugo 标准文件后直接部署而没有添加主题，遇到了与我同样的报错。笔者马上反应过来，在本地尝试 clone 仓库，发现 <code>/themes</code> 文件夹下为空，终于找到问题的根源了。解决也很简单，修改 Actions 的配置文件，在部署前添加 clone 主题仓库的命令即可。重新推送后，查看master 分支，增加了 <code>index.html</code> ，站点访问正常。</p><h2 id=0x04-致谢>0x04 致谢<a href=#0x04-致谢 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ul><li><p><a href=https://gohugo.io/>HUGO</a></p></li><li><p><a href=https://github.com/Track3/hermit>Hermit</a> by <a href=https://github.com/Track3/>Track3</a></p></li><li><p><a href=https://github.com/features/actions>Github Actions</a></p></li><li><p><a href=https://github.com/peaceiris/actions-hugo>actions-hugo</a> by <a href=https://github.com/peaceiris>peaceiris</a></p></li><li><p><a href=https://github.com/peaceiris/actions-gh-pages>actions-gh-pages</a> by <a href=https://github.com/peaceiris>peaceiris</a></p></li></ul></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather"><path d="M20.24 12.24a6 6 0 00-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg>An</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://explore-space.github.io/tags/blog>Blog</a></span><span class=tag><a href=https://explore-space.github.io/tags/github-actions>Github Actions</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>2533 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2019-12-17 23:31 +0800</p></footer></article><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#0x00-摘要>0x00 摘要</a></li><li><a href=#0x01-起源>0x01 起源</a></li><li><a href=#0x02-搭建>0x02 搭建</a><ul><li><a href=#创建仓库>创建仓库</a></li><li><a href=#创建分支>创建分支</a></li><li><a href=#更改默认分支>更改默认分支</a></li><li><a href=#添加ssh部署密钥>添加SSH部署密钥</a></li><li><a href=#创建-hugo-站点>创建 Hugo 站点</a></li><li><a href=#添加主题>添加主题</a></li><li><a href=#添加配置-github-actions-配置文件>添加配置 Github Actions 配置文件</a></li><li><a href=#推送>推送</a></li></ul></li><li><a href=#0x03-问题>0x03 问题</a><ul><li><a href=#密钥添加>密钥添加</a></li><li><a href=#git-子模块>Git 子模块</a></li></ul></li><li><a href=#0x04-致谢>0x04 致谢</a></li></ul></nav></aside><div class="post-nav thin"><a class=next-post href=https://explore-space.github.io/posts/primitive/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Primitive</span></a>
<a class=prev-post href=https://explore-space.github.io/posts/pi-init/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Raspbian[Lite] 初始化</span></a></div><div id=comments class=thin><head><link rel=stylesheet href=/CSS/style.css></head><link rel=stylesheet type=text/css href=style.css><span id=/posts/blog_auto/ class=leancloud_visitors data-flag-title="Hugo 自动部署"><span class=post-meta-item-text>文章阅读量</span>
<span class=leancloud-visitors-count>1000000</span><p></p></span><div id=vcomments></div><script src=//cdn1.lncld.net/static/js/3.0.4/av-min.js></script><script src=//unpkg.com/valine/dist/Valine.min.js></script><script type=text/javascript>new Valine({el:'#vcomments',appId:'o6kNKVy8OrAHuF71KC2EPujN-MdYXbMMI',appKey:'to5t9x8LMWghJuruIljDWsvP',notify:'',verify:'',avatar:'retro',placeholder:'嘤嘤嘤～',visitor:'true'});</script></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2021 <a href=https://explore-space.github.io/>An</a> &#183; <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 target=_blank rel=noopener>CC BY-NC-ND 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://explore-space.github.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://explore-space.github.io/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script></body></html>